{% extends "layout.html" %}
{% block beforeContent %}
    {{ govukBreadcrumbs({
  items: [
    {
      text: "Home",
      href: "/sections/" + scopeId
    },
    {
      text: browse_breadcrumb,
      href: ""
    }
  ]
}) }}
{% endblock %}

{% block content %}

    <span class="govuk-caption-xl">{{ title }}</span>
    <h1 class="govuk-heading-l">
        Commodity information for {{ commodity.data.attributes.goods_nomenclature_item_id }}
        <div class="copy_code" id="copy_code">
            <span id="copy_comm_code" class="pseudo-link govuk-link">Copy commodity code</span><br>
            <span class="copied">Code copied</span>
        </div>
        <noscript>
            <style>
                #copy_code {
                    display: none;
                }
            </style>
        </noscript>
    </h1>
    {% include "includes/intro_panel_short.html" %}

    <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">
      This tariff is for {{ date_string }}. Click to change
    </span>
        </summary>
        <div class="govuk-details__text">

            {{ govukDateInput({
  id: "date",
  namePrefix: "date",
  fieldset: {
    legend: {
      text: "On which date will your trade take place?",
      isPageHeading: false,
      classes: "govuk-fieldset__legend--s"
    }
  },
  hint: {
    text: ""
  },
  items: [
    {
      classes: "govuk-input--width-2",
      name: "day",
      value: "1"
    },
    {
      classes: "govuk-input--width-2",
      name: "month",
      value: "1"
    },
    {
      classes: "govuk-input--width-4",
      name: "year",
      value: "2021"
    }
  ]
}) }}
            {{ govukButton({
  text: "Update date"
}) }}

        </div>
    </details>

    <div class="panel">
        <nav class="breadcrumb">
            <ul class="govuk-list">
                {% set counter = 2 %}
                {% for item in commodity.included %}
                    {% if (item.type == "section") %}
                        <!-- Section //-->
                        <li class="section">
                            <a href="/sections/{{ item.id }}/{{ scopeId }}">Section {{ item.attributes.numeral }}: {{ item.attributes.title | safe }}</a>
                        </li>
                    {% endif %}
                    {% if (item.type == "chapter") %}
                        <!-- Chapter //-->
                        <li class="crumb indent_1">
                            <div class="commodity">
                                <span class="code mauve">{{ item.attributes.goods_nomenclature_item_id | substring(0, 2) }}</span>
                                <span class="code blue"></span>
                                <span class="code green"></span>
                                <span class="code green"></span>
                                <span class="code green"></span>
                            </div>
                            <div class="description">
                                <a href="/chapters/{{ item.attributes.goods_nomenclature_item_id | substring(0, 2) }}/{{ scopeId }}">{{ item.attributes.formatted_description | safe }}</a>
                            </div>
                        </li>
                    {% endif %}
                    {% if (item.type == "heading") %}
                        <!-- Heading //-->
                        <li class="crumb indent_2">
                            <div class="commodity">
                                <span class="code mauve">{{ item.attributes.goods_nomenclature_item_id | substring(0, 2) }}</span>
                                <span class="code blue">{{ item.attributes.goods_nomenclature_item_id | substring(2, 2) }}</span>
                                <span class="code green"></span>
                                <span class="code green"></span>
                                <span class="code green"></span>
                            </div>
                            <div class="description">
                                <a href="/headings/{{ item.attributes.goods_nomenclature_item_id | substring(0, 4) }}/{{ scopeId }}">{{ item.attributes.formatted_description | safe }}</a>
                            </div>
                        </li>
                    {% endif %}
                    {% if (item.type == "commodity") %}
                        {% set counter = (counter | default(2)) + 1 %}
                        <!-- Ancestors //-->
                        <li class="crumb indent_{{ counter }}">
                            <div class="commodity">
                                <span class="code mauve">{{ item.attributes.formatted_commodity_code | substring(0, 2) }}</span>
                                <span class="code blue">{{ item.attributes.formatted_commodity_code | substring(2, 2) }}</span>
                                <span class="code green">{{ item.attributes.formatted_commodity_code | substring(4, 2) }}</span>
                                <span class="code green">{{ item.attributes.formatted_commodity_code | substring(6, 2) }}</span>
                                <span class="code green">{{ item.attributes.formatted_commodity_code | substring(8, 2) }}</span>
                            </div>
                            <div class="description">
                                <a href="/headings/{{ item.attributes.goods_nomenclature_item_id | substring(0, 4) }}/{{ scopeId }}">{{ item.attributes.formatted_description | safe }}</a>
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
                <li class="crumb indent_{{ counter + 1 }}">
                    <div class="commodity">
                        <span class="code mauve">{{ commodity.data.attributes.goods_nomenclature_item_id | substring(0, 2) }}</span>
                        <span class="code blue">{{ commodity.data.attributes.goods_nomenclature_item_id | substring(2, 2) }}</span>
                        <span class="code green">{{ commodity.data.attributes.goods_nomenclature_item_id | substring(4, 2) }}</span>
                        <span class="code green">{{ commodity.data.attributes.goods_nomenclature_item_id | substring(6, 2) }}</span>
                        <span class="code green">{{ commodity.data.attributes.goods_nomenclature_item_id | substring(8, 2) }}</span>
                    </div>
                    <div class="description">{{ commodity.data.attributes.formatted_description }}</div>
                </li>
            </ul>
        </nav>
    </div>

    <div class="govuk-tabs" data-module="govuk-tabs">
        <h2 class="govuk-tabs__title">Contents</h2>
        <ul class="govuk-tabs__list">
            <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
                <a class="govuk-tabs__tab" href="#overview">Overview</a>
            </li>
            <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#import">Import</a>
            </li>
            <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#export">Export</a>
            </li>
            <!--
            <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#rules_of_origin">Rules of origin</a>
            </li>
            //-->
        </ul>
        <div class="govuk-tabs__panel" id="overview">
            <h2 class="govuk-heading-m">Overview</h2>
            <p>This information is for <strong>{{ date_string }}</strong>.</p>
            <div class="panels govuk-grid-row">
                <div class="panel govuk-grid-column-one-half" style="margin-right:1em">
                    <h2 class="govuk-heading-m">Import</h2>
                    <p>The commodity code for importing is <strong>{{ commodity.data.attributes.goods_nomenclature_item_id }}</strong>.</p>
                    <p>Goods are subject to VAT standard rate (<strong>20.00 %</strong>).</p>
                    <p>Importing from outside the EU is subject to a third country duty of <strong>{{ commodity.data.attributes.basic_duty_rate | safe }}</strong> unless subject to other measures.</p>
                    <p>Import measures and restrictions for specific countries can be found under the <a href="#import">import</a> tab.</p>
                    <h2 class="govuk-heading-s govuk-!-margin-bottom-0">Duty calculation</h2>
                    <p>Use our tariff duty calculator to work out the 
                        <a href="/calculate/date/{{ commodity.data.attributes.goods_nomenclature_item_id }}">duties&nbsp;applicable to the import of commodity {{ commodity.data.attributes.goods_nomenclature_item_id }} into the United Kingdom</a>.
                    </p>
                </div>
                <div class="panel govuk-grid-column-one-half">
                    <h2 class="govuk-heading-m">Export</h2>
                    <p>The commodity code for exporting and intrastat reporting is <strong>{{ commodity.data.attributes.goods_nomenclature_item_id | substring(0, 8) }}</strong>.</p>
                    <p>Export measures and restrictions for specific countries can be found under the <a href="#export">export</a> tab.</p>
                </div>
            </div>
        </div>
        <div class="govuk-tabs__panel" id="import">
            <h2 class="govuk-heading-m">Measures and restrictions for importing into the UK under the <abbr title="UK Global Tariff">UKGT</abbr>
            </h2>
            <!--<p>This information is for <strong>{{ date_string }}</strong>.</p>//-->

            {% include "includes/country_selector_import_new.html" %}

            <nav>
                <h2 class="govuk-heading-m govuk-!-margin-top-7 govuk-!-margin-bottom-3">Measure groups</h2>
                <ul class="app-contents app-contents--s govuk-!-margin-bottom-0">
                    {% for display_block in commodity.display_blocks %}
                        <li class="govuk-!-margin-bottom-2">
                            <a class="govuk-body" href="#block_{{ display_block.index }}">
                                {% if scopeId == "ni" %}
                                    {{ display_block.block_xi }}
                                {% else %}
                                    {{ display_block.block }}
                                {% endif %}
                            </a>
                        </li>
                    {% endfor %}

                </ul>
            </nav>

            {% for display_block in commodity.display_blocks %}
                <h3 id="block_{{ display_block.index }}" class="govuk-heading-m govuk-!-margin-top-7 govuk-!-margin-bottom-3">
                    {% if scopeId == "ni" %}
                        {{ display_block.block_xi }}
                    {% else %}
                        {{ display_block.block }}
                    {% endif %}
                </h3>
                {% if display_block.explainers %}
                    <div class="govuk-inset-text govuk-inset-text--s">
                        {% if scopeId == "ni" %}
                            {% if display_block.explainers.prose_ni %}
                                {{ display_block.explainers.prose_ni | safe }}
                            {% endif %}
                        {% else %}
                            {% if display_block.explainers.prose %}
                                {{ display_block.explainers.prose | safe }}
                            {% endif %}
                        {% endif %}

                    </div>

                {% endif %}

                {% if display_block.block != "Import controls" and display_block.block != "UK import controls" %}
                    {% set class = "standard" %}
                {% else %}
                    {% set class = "control" %}
                {% endif %}
                <table class="govuk-table govuk-table--s  measures2 app-flexible-table">
                    <thead class="govuk-table__head app-flexible-table__head">
                        <tr class="govuk-table__row app-flexible-table__row {{ class }}">
                            <th scope="col" class="govuk-table__header country app-flexible-table__header">Country</th>
                            <th scope="col" class="govuk-table__header measure app-flexible-table__header">Measure type</th>
                            {% if display_block.block != "Import controls" and display_block.block != "UK import controls" %}
                                <th scope="col" class="govuk-table__header value app-flexible-table__header">Value</th>
                            {% endif %}
                            <th scope="col" class="govuk-table__header conditions app-flexible-table__header c">Conditions</th>
                            <th scope="col" class="govuk-table__header dates app-flexible-table__header">Date&nbsp;(s)</th>
                            <th scope="col" class="govuk-table__header footnotes app-flexible-table__header c">Footnotes</th>
                        </tr>
                    </thead>
                    <tbody class="govuk-table__body  app-flexible-table__body">
                        {% for measure in commodity.measures %}
                            {% if (measure.import == true) and (measure.display_block.block == display_block.block) %}
                                <tr class="govuk-table__row measure app-flexible-table__row {{ class }}">

                                    <td class="govuk-table__cell country app-flexible-table__cell" scope="row" data-column-heading="Country">
                                        {% if (measure.geographical_area.geographical_area_code == 1) %}
                                            <a href="{% if (scopeId == 'ni') %}/ni{% endif %}/geographical_area/{{ measure.geographical_area_id }}">{{ measure.geographical_area_description }}</a>
                                            <!-- ({{ measure.geographical_area.id }})//-->
                                            {% if measure.excluded_country_string != "" %}
                                                <br>
                                                <span class="v-small">excluding {{ measure.excluded_country_string }}</span>
                                            {% endif %}
                                        {% else %}
                                            {{ measure.geographical_area_description }} ({{ measure.geographical_area.id }})
                                        {% endif %}
                                    </td>
                                    <td class="govuk-table__cell measure app-flexible-table__cell" scope="row" data-column-heading="Measure type">
                                        <div>
                                            <span class="table-line">{{ measure.measure_type_description }}</span>
                                            {% if measure.order_number_id %}
                                                <span class="table-line">Order no: <a href="#quota_{{ measure.order_number_id }}" rel="modal:open">{{ measure.order_number_id }}</a>
                                                </span>
                                            {% endif %}
                                            {% if measure.additional_code %}
                                                <span class="table-line">Additional code: <b>{{ measure.additional_code.code | title_case }}</b>
                                                </span><span class="table-line">{{ measure.additional_code.description | safe }}</span>
                                            {% endif %}
                                        </div>
                                    </td>

                                    {% if display_block.block != "Import controls" and display_block.block != "UK import controls" %}
                                        <td class="govuk-table__cell value app-flexible-table__cell" scope="row" data-column-heading="Value">
                                            {% if measure.duty_bearing %}
                                                {% if measure.duty_expression.formatted_base %}
                                                    {{ measure.duty_expression.formatted_base | safe }}
                                                {% else %}
                                                &nbsp;
                                            {% endif %}
                                            {% else %}
                                        n/a
                                        {% endif %}
                                        </td>
                                    {% endif %}

                                    <td class="govuk-table__cell conditions app-flexible-table__cell c" scope="row" data-column-heading="Conditions">
                                        {% if measure.has_conditions == true %}
                                            <a href="#measure_conditions_{{ measure.id }}" rel="modal:open">Conditions</a>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>

                                    <td class="govuk-table__cell dates app-flexible-table__cell nw" scope="row" data-column-heading="Date (s)" nowrap>
                                        {{ measure.effective_start_date | format_date("DD MMM YYYY") }}
                                        {% if measure.effective_end_date %} - {{ measure.effective_end_date | format_date("DD MMM YYYY") }}
                                        {% endif %}
                                    </td>

                                    <td class="govuk-table__cell dates app-flexible-table__cell c" scope="row" data-column-heading="Footnotes" nowrap>
                                        {% if measure.has_footnotes %}
                                            {% if measure.footnotes.length == 1 %}
                                                <a href="#footnotes_{{ measure.id }}" rel="modal:open">{{ measure.footnotes[0].code }}</a>
                                            {% else %}
                                                <a href="#footnotes_{{ measure.id }}" rel="modal:open">Footnotes</a>
                                            {% endif %}
                                        {% else %}-
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}

                    </tbody>
                </table>
                <!--<p class="govuk-body govuk-!-margin-top-4 govuk-!-font-size-16x">{{ display_block.link_text | safe }}</p>//-->
            {% endfor %}

        </div>
        <div class="govuk-tabs__panel" id="export">
            <h2 class="govuk-heading-m">Export measures and restrictions</h2>
            <p>This information is for <strong>{{ date_string }}</strong>.</p>
            {% include "includes/country_selector_export.html" %}
        </div>
        <!--
        <div class="govuk-tabs__panel" id="rules_of_origin">
            <h2 class="govuk-heading-m">Rules of origin</h2>
            <p>If you are importing goods into the UK, you may be able to claim a preferential customs duty rate
            if the country from which the goods are coming has a Trade Agreement with the UK.</p>
            <p>Select the country from which the goods are coming to identify if there are any applicable rules of 
            origin that will impact your import.</p>

            {% include "includes/country_selector_roo.html" %}

        </div>//-->

    </div>
    {% if commodity.footnotes.length %}
        <table class="govuk-table govuk-table--s">
            <caption class="govuk-table__caption">Footnotes</caption>
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header">Code</th>
                    <th scope="col" class="govuk-table__header">Description</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                {% for item in heading.footnotes %}
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">{{ item.code }}</td>
                        <td class="govuk-table__cell">{{ item.description | safe }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    {% endif %}

</div>
<!-- Start footnotes //-->
{% for measure in commodity.measures %}
    {% if measure.has_footnotes == true %}
        <div id="footnotes_{{ measure.id }}" class="modal modal_commodity">
            <h2 class="govuk-heading govuk-heading-m govuk-!-margin-top-4">Footnotes for measure {{ measure.measure_type_description }}</h1>
            <p>The table below shows the conditions associated with the {{ measure.measure_type_description }} measure 
            on the import of commodity <strong>{{ commodity.data.attributes.goods_nomenclature_item_id }}</strong> from
            <strong>{{ measure.geographical_area_description }}</strong>.</p>

            <table class="govuk-table govuk-table--m">
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Code</th>
                        <th scope="col" class="govuk-table__header">Description</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    {% for f in measure.footnotes %}
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell b">{{ f.code }}</td>
                            <td class="govuk-table__cell">{{ f.description | safe }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endfor %}
<!-- End footnotes //-->

<!-- Start conditions //-->
{% for measure in commodity.measures %}
    {% if measure.has_conditions == true %}
        <div id="measure_conditions_{{ measure.id }}" class="modal modal_commodity">
            <h2 class="govuk-heading govuk-heading-m govuk-!-margin-top-4">Conditions for {{ measure.measure_type_description }}</h1>
            <p>The table below shows the conditions associated with the {{ measure.measure_type_description }} measure 
            on the import of commodity <strong>{{ commodity.data.attributes.goods_nomenclature_item_id }}</strong> from
            <strong>{{ measure.geographical_area_description }}</strong>.</p>
            <p>{{ measure.popup_message }}</p>

            <table class="govuk-table govuk-table--m">
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Code</th>
                        <th scope="col" class="govuk-table__header">Requirement</th>
                        <th scope="col" class="govuk-table__header">Details</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    {% for mc in measure.exposed_conditions %}
                        {% if mc.positive %}
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell b">{{ mc.document_code }}</td>
                                <td class="govuk-table__cell">
                                    {{ mc.requirement | safe }}
                                    {% if mc.article_5a.details != "" %}
                                        {# <details class="govuk-details govuk-details-m govuk-!-margin-top-2" data-module="govuk-details">
                                            <summary class="govuk-details__summary">
                                                <span class="govuk-details__summary-text">Details to be entered on the declaration</span>
                                            </summary>
                                            <div class="govuk-details__text">{{ mc.article_5a.details | safe }}</div>
                                        </details> #}
                                    {% endif %}
                                </td>
                                <td class="govuk-table__cell">{{ mc.article_5a.details | safe }}</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
            <details class="govuk-details govuk-details-m govuk-!-margin-top-2" data-module="govuk-details">
                <summary class="govuk-details__summary">
                    <span class="govuk-details__summary-text">How to read measure conditions</span>
                </summary>
                <div class="govuk-details__text">
                    Enter document codes on your forms ...
                </div>
            </details>
        </div>
    {% endif %}
{% endfor %}
<!-- End conditions //-->

<!-- Start quotas //-->
{% for measure in commodity.measures %}
    {% if measure.order_number_id != null %}
        <div id="quota_{{ measure.order_number_id }}" class="modal modal_commodity">
            <h2 class="govuk-heading govuk-heading-m govuk-!-margin-top-4">Quota {{ measure.order_number_id }}</h1>
            {# <p>The table below shows the current state of quota {{ measure.order_number_id }}.</p> #}
            <div class="govuk-warning-text">
                <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                <strong class="govuk-warning-text__text">
                    <span class="govuk-warning-text__assistive">Warning</span>
                    Please be aware - this is a child quota and ....</strong>
            </div>

            <table class="govuk-table govuk-table--m">
                <tbody class="govuk-table__body">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Quota order number</th>
                        <td class="govuk-table__cell">{{ measure.order_number_id }}</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Current balance</th>
                        <td class="govuk-table__cell">1234 kilograms</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Opening balance</th>
                        <td class="govuk-table__cell">1234 kilograms</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Status</th>
                        <td class="govuk-table__cell">Open</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Start and end dates</th>
                        <td class="govuk-table__cell">1 Apr 2021 to 30 Jun 2021</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Last allocation date</th>
                        <td class="govuk-table__cell">1 May 2021</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Suspension period</th>
                        <td class="govuk-table__cell">n/a</th>
                    </tr>
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Blocking period</th>
                        <td class="govuk-table__cell">n/a</th>
                    </tr>
                </tbody>
            </table>
            <p>In an effort to facilitate UK importers HMRC endeavours to keep quotas 'OPEN' where possible, therefore the information displayed above may differ slightly from the current UK position. If you require further information contact the Tariff Quota Management Team by email: <a href="mailto:tariff.management@hmrc.gsi.gov.uk">tariff.management@hmrc.gsi.gov.uk</a>.</p>
        </div>
    {% endif %}
{% endfor %}
<!-- End quotas //-->

<script type="text/javascript" src="/public/javascripts/accessible-autocomplete.min.js"></script>
<script type="text/javascript">
    var selectEl = document.querySelector('#location-picker')
    accessibleAutocomplete.enhanceSelectElement({autoselect: true, confirmOnBlur: true, defaultValue: "", minLength: 2, selectElement: selectEl})

    var queryStringParameters = window.location.search
    var previouslySubmitted = queryStringParameters.length > 0
    if (previouslySubmitted) {
        var submittedEl = document.querySelector('.submitted')
        submittedEl
            .classList
            .remove('submitted--hidden')
        var params = new URLSearchParams(document.location.search.split('?')[1])
        document
            .querySelector('.submitted__location-picker')
            .innerHTML = params.get('location-picker')
    }
</script>

<script type="text/javascript">
    $(function () {
        $("#copy_comm_code").click(function (event) {
            copyToClipboard("{{ commodity.data.attributes.goods_nomenclature_item_id }}");

            $(".copied").css("text-indent", "0");
            $(".copied")
                .delay(500)
                .fadeOut(750, function () {
                    $(".copied").css("text-indent", "-999em");
                    $(".copied").css("display", "block");
                });
            event.preventDefault();
        });

        function copyToClipboard(text) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp
                .val(text)
                .select();
            document.execCommand("copy");
            $temp.remove();
        }

    });
</script>

{% endblock %}
</html>